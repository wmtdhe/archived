<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hot Module Reload 热重载 | 亿个本子</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/archived/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/archived/favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" href="/archived/favicon/favicon-32x32.png">
    <link rel="manifest" href="/archived/favicon/site.webmanifest">
    <meta name="description" content="frontend related notes">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/archived/assets/css/0.styles.44ae0491.css" as="style"><link rel="preload" href="/archived/assets/js/app.8b58d644.js" as="script"><link rel="preload" href="/archived/assets/js/2.bf33e473.js" as="script"><link rel="preload" href="/archived/assets/js/45.ec35426d.js" as="script"><link rel="prefetch" href="/archived/assets/js/10.08eb2b05.js"><link rel="prefetch" href="/archived/assets/js/11.8af729f7.js"><link rel="prefetch" href="/archived/assets/js/12.89a362e4.js"><link rel="prefetch" href="/archived/assets/js/13.333ebb92.js"><link rel="prefetch" href="/archived/assets/js/14.fecca8fb.js"><link rel="prefetch" href="/archived/assets/js/15.d74cca93.js"><link rel="prefetch" href="/archived/assets/js/16.33b6a90d.js"><link rel="prefetch" href="/archived/assets/js/17.a8d0bc73.js"><link rel="prefetch" href="/archived/assets/js/18.99e676ac.js"><link rel="prefetch" href="/archived/assets/js/19.8f4f6bc7.js"><link rel="prefetch" href="/archived/assets/js/20.b60b2514.js"><link rel="prefetch" href="/archived/assets/js/21.1409a82a.js"><link rel="prefetch" href="/archived/assets/js/22.0f7af644.js"><link rel="prefetch" href="/archived/assets/js/23.24d2717c.js"><link rel="prefetch" href="/archived/assets/js/24.1f557f08.js"><link rel="prefetch" href="/archived/assets/js/25.6d9fa012.js"><link rel="prefetch" href="/archived/assets/js/26.0c4a868e.js"><link rel="prefetch" href="/archived/assets/js/27.4452b985.js"><link rel="prefetch" href="/archived/assets/js/28.f467e649.js"><link rel="prefetch" href="/archived/assets/js/29.13e49743.js"><link rel="prefetch" href="/archived/assets/js/3.9903a5d7.js"><link rel="prefetch" href="/archived/assets/js/30.f8890062.js"><link rel="prefetch" href="/archived/assets/js/31.22830e2f.js"><link rel="prefetch" href="/archived/assets/js/32.9945a466.js"><link rel="prefetch" href="/archived/assets/js/33.8354ffb2.js"><link rel="prefetch" href="/archived/assets/js/34.b80b6b78.js"><link rel="prefetch" href="/archived/assets/js/35.b5435a07.js"><link rel="prefetch" href="/archived/assets/js/36.6eb06aac.js"><link rel="prefetch" href="/archived/assets/js/37.78e82f4a.js"><link rel="prefetch" href="/archived/assets/js/38.bae8bf11.js"><link rel="prefetch" href="/archived/assets/js/39.61fc07c0.js"><link rel="prefetch" href="/archived/assets/js/4.45587ab2.js"><link rel="prefetch" href="/archived/assets/js/40.4ff96977.js"><link rel="prefetch" href="/archived/assets/js/41.24669c96.js"><link rel="prefetch" href="/archived/assets/js/42.c40fcb14.js"><link rel="prefetch" href="/archived/assets/js/43.77267e49.js"><link rel="prefetch" href="/archived/assets/js/44.684a4efa.js"><link rel="prefetch" href="/archived/assets/js/46.9af30f73.js"><link rel="prefetch" href="/archived/assets/js/5.7048f9e2.js"><link rel="prefetch" href="/archived/assets/js/6.51e4d4fc.js"><link rel="prefetch" href="/archived/assets/js/7.43067d64.js"><link rel="prefetch" href="/archived/assets/js/8.09d20108.js"><link rel="prefetch" href="/archived/assets/js/9.c803c07c.js">
    <link rel="stylesheet" href="/archived/assets/css/0.styles.44ae0491.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/archived/" class="home-link router-link-active"><img src="/archived/favicon/favicon-32x32.png" alt="亿个本子" class="logo"> <span class="site-name can-hide">亿个本子</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/wmtdhe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/wmtdhe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/archived/webpack/treeshaking.html" class="sidebar-link">Tree Shaking</a></li><li><a href="/archived/webpack/hotmodulereload.html" aria-current="page" class="active sidebar-link">HMR原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Networks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Operation System</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Micellaneous</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Practice</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="hot-module-reload-热重载"><a href="#hot-module-reload-热重载" class="header-anchor">#</a> Hot Module Reload 热重载</h2> <h3 id="热重载特点："><a href="#热重载特点：" class="header-anchor">#</a> 热重载特点：</h3> <ul><li>完全重载app的状态会丢失，而热重载会保持状态不变</li> <li>只更新变化了的内容，节省开发时间</li> <li>当<code>CSS</code>或<code>JS</code>发生变化时，立即反映在浏览器里</li></ul> <h3 id="热重载如何工作的："><a href="#热重载如何工作的：" class="header-anchor">#</a> 热重载如何工作的：</h3> <h4 id="在程序（application）中"><a href="#在程序（application）中" class="header-anchor">#</a> 在程序（Application）中</h4> <p>以下步骤使得模块可以在程序中被替换和添加：</p> <ol><li>app让HMR运行时（runtime）来检查更新</li> <li>运行时异步下载更新并通知程序</li> <li>程序接下来请求运行时使用（<code>apply</code>）这些更新</li> <li>运行时同步应用（<code>apply</code>）这些更新</li></ol> <h4 id="在编译（compiler）中"><a href="#在编译（compiler）中" class="header-anchor">#</a> 在编译（Compiler）中</h4> <p>除了普通的资源外（assets），编译器还需要释放一个<code>update</code>信号来使得从旧版本更新到新版本。这个更新信号包括两部分：</p> <ol><li>更新后的<code>manifest</code>(the updated manifest)（<code>JSON</code>）</li> <li>一个或多个更新后的代码块<code>chunks</code>（<code>JavaScript</code>）</li></ol> <p>这个<code>manifest</code>包含了新的编译哈希和一个列表的更新了的代码块（<code>chunks</code>）。每个代码块包含了模块（<code>module</code>）新更新的代码，（或是一个表面模块被移除的标识）。</p> <p>编译器保证了模块ID和代码块ID在各个构建之间是保持一致的。通常这些ID是存放在缓存中的（利用<code>webpack-dev-server</code>），但也可能把它们存在一个JSON文件中。</p> <h4 id="在模块（module）中"><a href="#在模块（module）中" class="header-anchor">#</a> 在模块（Module）中</h4> <p>一个单独的更新处理器<code>(update handler)</code>可以更新一整个模块树<code>(module tree)</code>。如果树中的一个单独模块被更新了，那么整个依赖也会被重新加载。</p> <h4 id="在运行时（runtime）中"><a href="#在运行时（runtime）中" class="header-anchor">#</a> 在运行时（Runtime）中</h4> <p>对于模块系统运行时（<code>module system runtime</code>）而言，更多的代码会被释放来追踪模块的<code>parent</code>和<code>children</code>。在管理层面来说，运行时支持两个方法：<code>check</code>和<code>apply</code>。</p> <p><code>check</code>方法发送一个HTTP请求来请求<code>更新manifest</code>。如果请求失败，则表明没有更新存在。如果请求成功了，一列表的更新后的代码块会和当前已经加载的代码块进行对比。对于每个加载了的代码块而言，对应的更新代码块会随之下载。所有模块的更新都会被存在运行时。当所有更新了的代码块都被下载完成并可以使用时，运行时会切换到<code>ready</code>状态。</p> <p><code>apply</code>方法标记所有更新了的模块为<code>(invalid)</code>不可用的。对于每个不可用的模块而言，它们需要有一个更新处理器在它们或者它们父级的模块中，否则的话，这些不可用的标记会冒泡而上将父级模块也标记为不可用的。每个冒泡持续直到程序的入口处或者有更新处理器的模块。如果一直冒泡到入口处，则表面这个过程失败。</p> <p>紧接着，所有标为不可用<code>(invalid)</code>的模块会被舍弃和卸载。当前的哈希会被更新，所有的<code>accept</code>处理器会被调用。运行时会切换到<code>idle</code>状态，一切进程又恢复如初。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/archived/webpack/treeshaking.html" class="prev">
        Tree Shaking
      </a></span> <span class="next"><a href="/archived/networks/http-status-code.html">
        HTTP状态码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/archived/assets/js/app.8b58d644.js" defer></script><script src="/archived/assets/js/2.bf33e473.js" defer></script><script src="/archived/assets/js/45.ec35426d.js" defer></script>
  </body>
</html>
