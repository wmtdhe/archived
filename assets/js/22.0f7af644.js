(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{375:function(e,v,_){"use strict";_.r(v);var o=_(25),r=Object(o.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("blockquote",[_("p",[e._v("来源：https://promisesaplus.com/")])]),e._v(" "),_("h2",{attrs:{id:"_1-术语"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-术语"}},[e._v("#")]),e._v(" 1. 术语")]),e._v(" "),_("ul",[_("li",[e._v("1.1. "),_("code",[e._v("promise")]),e._v("是一个有"),_("code",[e._v("then")]),e._v("方法的"),_("code",[e._v("obj")]),e._v("或者"),_("code",[e._v("function")]),e._v("。")]),e._v(" "),_("li",[e._v("1.2. "),_("code",[e._v("thenable")]),e._v("是定义了"),_("code",[e._v("then")]),e._v("方法的一个"),_("code",[e._v("obj")]),e._v("或者"),_("code",[e._v("function")]),e._v("。")]),e._v(" "),_("li",[e._v("1.3. "),_("code",[e._v("value")]),e._v("是任意JS合法的取值，包含"),_("code",[e._v("undefined")]),e._v("，"),_("code",[e._v("thenable")]),e._v("或者"),_("code",[e._v("promise")]),e._v("。")]),e._v(" "),_("li",[e._v("1.4. "),_("code",[e._v("exception")]),e._v("是用"),_("code",[e._v("throw")]),e._v(" statement抛出的一个值。")]),e._v(" "),_("li",[e._v("1.5. "),_("code",[e._v("reason")]),e._v("是一个表明为什么"),_("code",[e._v("promise")]),e._v("被"),_("code",[e._v("rejected")]),e._v("的值。")])]),e._v(" "),_("h2",{attrs:{id:"_2-要求"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-要求"}},[e._v("#")]),e._v(" 2. 要求")]),e._v(" "),_("h3",{attrs:{id:"_2-1-promise状态"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-promise状态"}},[e._v("#")]),e._v(" 2.1. Promise状态")]),e._v(" "),_("p",[e._v("一个promise必须处于以下三个状态中的一个："),_("code",[e._v("pending")]),e._v(", "),_("code",[e._v("fulfilled")]),e._v(", 或者"),_("code",[e._v("rejected")]),e._v("。")]),e._v(" "),_("ul",[_("li",[e._v("2.1.1. 当处于"),_("code",[e._v("pending")]),e._v("时，一个promise：\n"),_("ul",[_("li",[e._v("2.1.1.1. 可能会过渡到"),_("code",[e._v("fulfilled")]),e._v("或者"),_("code",[e._v("rejected")]),e._v("状态。")])])]),e._v(" "),_("li",[e._v("2.1.2. 当"),_("code",[e._v("fulfilled")]),e._v("时，一个promise：\n"),_("ul",[_("li",[e._v("2.1.2.1. 不能过渡到别的状态。")]),e._v(" "),_("li",[e._v("2.1.2.2. 必须有一个不能改变"),_("code",[e._v("value")]),e._v("。")])])]),e._v(" "),_("li",[e._v("2.1.3. 当"),_("code",[e._v("rejected")]),e._v("时，一个promise：\n"),_("ul",[_("li",[e._v("2.1.3.1. 不能过渡到别的状态。")]),e._v(" "),_("li",[e._v("2.1.3.2. 必须有一个不能改变的"),_("code",[e._v("reason")]),e._v("。")])])])]),e._v(" "),_("h3",{attrs:{id:"_2-2-then方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-then方法"}},[e._v("#")]),e._v(" 2.2. "),_("code",[e._v("then")]),e._v("方法")]),e._v(" "),_("p",[e._v("一个promise必须有一个"),_("code",[e._v("then")]),e._v("方法来获取它的当前或者最终的"),_("code",[e._v("value")]),e._v("或者"),_("code",[e._v("reason")]),e._v("。")]),e._v(" "),_("p",[e._v("一个promise的"),_("code",[e._v("then")]),e._v("方法接收两个参数:")]),e._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("promise.then(onFulfilled, onRejected)\n")])])]),_("ul",[_("li",[e._v("2.2.1. "),_("code",[e._v("onFulfilled")]),e._v("，"),_("code",[e._v("onRejected")]),e._v("都是optional的参数：\n"),_("ul",[_("li",[e._v("2.2.1.1. 如果"),_("code",[e._v("onFulfilled")]),e._v("不是一个方法必须被忽略。")]),e._v(" "),_("li",[e._v("2.2.1.2. "),_("code",[e._v("onRejected")]),e._v("不是一个方法必须被忽略。")])])]),e._v(" "),_("li",[e._v("2.2.2. 如果"),_("code",[e._v("onFulfilled")]),e._v("是一个方法：\n"),_("ul",[_("li",[e._v("2.2.2.1. 当"),_("code",[e._v("promise")]),e._v("被满足时，它必须被调用。 "),_("code",[e._v("promise")]),e._v("的值作为它的第一个参数。")]),e._v(" "),_("li",[e._v("2.2.2.2. 必不能在"),_("code",[e._v("promise")]),e._v("被满足前被调用。")]),e._v(" "),_("li",[e._v("2.2.2.3. 不能被调用超过一次。")])])]),e._v(" "),_("li",[e._v("2.2.3. 如果"),_("code",[e._v("onRejected")]),e._v("是一个方法:\n"),_("ul",[_("li",[e._v("2.2.3.1. 当"),_("code",[e._v("promise")]),e._v("被拒绝时，它必须被调用。"),_("code",[e._v("promise")]),e._v("的理由作为它的第一个参数。")]),e._v(" "),_("li",[e._v("2.2.3.2. 必不能在"),_("code",[e._v("promise")]),e._v("被拒绝前调用。")]),e._v(" "),_("li",[e._v("2.2.3.3. 不能被调用超过一次。")])])]),e._v(" "),_("li",[e._v("2.2.4. "),_("code",[e._v("onFulfilled")]),e._v("或者"),_("code",[e._v("onRejected")]),e._v("不能被调用直到"),_("a",{attrs:{href:"https://es5.github.io/#x10.3",target:"_blank",rel:"noopener noreferrer"}},[e._v("execution context"),_("OutboundLink")],1),e._v("栈只有platform code. ["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.1"),_("OutboundLink")],1),e._v("]")]),e._v(" "),_("li",[e._v("2.2.5. "),_("code",[e._v("onFulfilled")]),e._v("和"),_("code",[e._v("onRejected")]),e._v("必须被当作方法调用（没有 "),_("code",[e._v("this")]),e._v("参与）。["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.2"),_("OutboundLink")],1),e._v("]")]),e._v(" "),_("li",[e._v("2.2.6. "),_("code",[e._v("then")]),e._v("可以在同一个promise上被多次调用。\n"),_("ul",[_("li",[e._v("2.2.6.1. 如果/当"),_("code",[e._v("promise")]),e._v("被满足，所有相对的 "),_("code",[e._v("onFulfilled")]),e._v("的回调都必须按照它们产生的顺序被执行。")]),e._v(" "),_("li",[e._v("2.2.6.2. 如果/当"),_("code",[e._v("promise")]),e._v("被拒绝，所有相对的 "),_("code",[e._v("onRejected")]),e._v("的回调都必须按照它们产生的顺序被执行。")])])]),e._v(" "),_("li",[e._v("2.2.7. "),_("code",[e._v("then")]),e._v("必须返回一个promise ["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.3"),_("OutboundLink")],1),e._v("]."),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("promise2 = promise1.then(onFufilled, onRejected);\n")])])]),_("ul",[_("li",[e._v("2.2.7.1. 如果"),_("code",[e._v("onFulfilled")]),e._v("或者 "),_("code",[e._v("onRejected")]),e._v("返回一个值"),_("code",[e._v("x")]),e._v("，执行Promise Resolution Procedure "),_("code",[e._v("[[Resolve]](promise2, x)")]),e._v(" 。")]),e._v(" "),_("li",[e._v("2.2.7.2. 如果"),_("code",[e._v("onFulfilled")]),e._v("或者 "),_("code",[e._v("onRejected")]),e._v("抛出一个例外"),_("code",[e._v("e")]),e._v("， "),_("code",[e._v("promise2")]),e._v("必须用这个"),_("code",[e._v("e")]),e._v("作为理由被拒绝。")]),e._v(" "),_("li",[e._v("2.2.7.3. 如果"),_("code",[e._v("onFulfilled")]),e._v("不是一个方法并且 "),_("code",[e._v("promise1")]),e._v("被满足，"),_("code",[e._v("promise2")]),e._v("必须用和 "),_("code",[e._v("promise1")]),e._v("一样的值被满足。")]),e._v(" "),_("li",[e._v("2.2.7.4. 如果"),_("code",[e._v("onRejected")]),e._v("不是一个方法并且 "),_("code",[e._v("promise1")]),e._v("被拒绝，"),_("code",[e._v("promise2")]),e._v("必须用和 "),_("code",[e._v("promise1")]),e._v("一样的理由被拒绝。")])])])]),e._v(" "),_("h3",{attrs:{id:"_2-3-the-promise-resolution-procedure"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-the-promise-resolution-procedure"}},[e._v("#")]),e._v(" 2.3. The Promise Resolution Procedure")]),e._v(" "),_("p",[_("strong",[e._v("Promise resolution procedure")]),e._v(" 是一个抽象的操作，以一个promise和一个"),_("code",[e._v("value")]),e._v("作为input - "),_("code",[e._v("[[Resolve]](promise,x)")]),e._v("。如果"),_("code",[e._v("x")]),e._v("是"),_("code",[e._v("thenable")]),e._v("，它会尝试让"),_("code",[e._v("promise")]),e._v("采纳这个"),_("code",[e._v("x")]),e._v("的状态，在基于"),_("code",[e._v("x")]),e._v("的行为和promise一样的猜想下。否则它将用这个"),_("code",[e._v("x")]),e._v("作为值满足"),_("code",[e._v("promise")]),e._v("。")]),e._v(" "),_("p",[_("code",[e._v("[[Resolve]](promise, x)")]),e._v("步骤：")]),e._v(" "),_("ul",[_("li",[e._v("2.3.1. 如果"),_("code",[e._v("promise")]),e._v("和"),_("code",[e._v("x")]),e._v("指的是同一对象，用"),_("code",[e._v("TypeError")]),e._v("作为理由拒绝这个"),_("code",[e._v("promise")]),e._v("。")]),e._v(" "),_("li",[e._v("2.3.2. 如果"),_("code",[e._v("x")]),e._v("是一个promise，采纳它的状态 ["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.4"),_("OutboundLink")],1),e._v("]：\n"),_("ul",[_("li",[e._v("2.3.2.1. 如果"),_("code",[e._v("x")]),e._v("在"),_("code",[e._v("pending")]),e._v("状态，"),_("code",[e._v("promise")]),e._v("必须保持"),_("code",[e._v("pending")]),e._v("直到"),_("code",[e._v("x")]),e._v("被满足或被拒绝。")]),e._v(" "),_("li",[e._v("2.3.2.2. 如果/当"),_("code",[e._v("x")]),e._v("被满足，用同样的值满足"),_("code",[e._v("promise")])]),e._v(" "),_("li",[e._v("2.3.2.3. 如果/当"),_("code",[e._v("x")]),e._v("被拒绝，用同样的理由拒绝"),_("code",[e._v("promise")]),e._v("。")])])]),e._v(" "),_("li",[e._v("2.3.3. 如果"),_("code",[e._v("x")]),e._v("是对象或者方法：\n"),_("ul",[_("li",[e._v("2.3.3.1. "),_("code",[e._v("then = x.then")]),e._v("["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.5"),_("OutboundLink")],1),e._v("]。")]),e._v(" "),_("li",[e._v("2.3.3.2. 如果获取"),_("code",[e._v("x.then")]),e._v("报错"),_("code",[e._v("e")]),e._v("，用这个"),_("code",[e._v("e")]),e._v("拒绝"),_("code",[e._v("promise")]),e._v("。")]),e._v(" "),_("li",[e._v("2.3.3.3. 如果"),_("code",[e._v("then")]),e._v("是一个方法，用"),_("code",[e._v("x")]),e._v("作为上下文调用它，第一个参数是"),_("code",[e._v("resolvePromise")]),e._v(", 第二个参数是"),_("code",[e._v("rejectPromise")]),e._v(":\n"),_("ul",[_("li",[e._v("2.3.3.3.1. 如果/当"),_("code",[e._v("resolvePromise")]),e._v("同一个值"),_("code",[e._v("y")]),e._v("一起被调用，执行"),_("code",[e._v("[[Resolve]](promise,y)")])]),e._v(" "),_("li",[e._v("2.3.3.3.2. 如果/当 "),_("code",[e._v("rejectPromise")]),e._v("同一个理由"),_("code",[e._v("r")]),e._v("被调用，用"),_("code",[e._v("r")]),e._v("拒绝"),_("code",[e._v("promise")]),e._v("。")]),e._v(" "),_("li",[e._v("2.3.3.3.3. 如果"),_("code",[e._v("resolvePromise")]),e._v(","),_("code",[e._v("rejectPromise")]),e._v("都被调用，或者参数被多次调用，第一次调用执行，之后的调用都被忽略。")]),e._v(" "),_("li",[e._v("2.3.3.3.4. 如果调用"),_("code",[e._v("then")]),e._v("抛错"),_("code",[e._v("e")]),e._v("：\n"),_("ul",[_("li",[e._v("2.3.3.3.4.1. 如果"),_("code",[e._v("resolvePromise")]),e._v("或"),_("code",[e._v("rejectPromise")]),e._v("已经被调用，忽略这个"),_("code",[e._v("e")]),e._v("。")]),e._v(" "),_("li",[e._v("2.3.3.3.4.2. 否则拒绝"),_("code",[e._v("promise")]),e._v(" with "),_("code",[e._v("e")]),e._v("。")])])])])]),e._v(" "),_("li",[e._v("2.3.3.4. 如果"),_("code",[e._v("then")]),e._v("不是方法，用"),_("code",[e._v("x")]),e._v("满足"),_("code",[e._v("promise")]),e._v("。")])])]),e._v(" "),_("li",[e._v("2.3.4. 如果"),_("code",[e._v("x")]),e._v("不是对象也不是方法，用"),_("code",[e._v("x")]),e._v("满足"),_("code",[e._v("promise")]),e._v("。")])]),e._v(" "),_("blockquote",[_("p",[e._v("If a promise is resolved with a thenable that participates in a circular thenable chain, such that the recursive nature of [[Resolve]](promise, thenable) eventually causes [[Resolve]](promise, thenable) to be called again, following the above algorithm will lead to infinite recursion. Implementations are encouraged, but not required, to detect such recursion and reject promise with an informative TypeError as the reason. ["),_("a",{attrs:{href:"https://promisesaplus.com/#notes",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.6"),_("OutboundLink")],1),e._v("]")])])])}),[],!1,null,null,null);v.default=r.exports}}]);